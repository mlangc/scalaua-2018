<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/css/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/css/theme/sky.min.css" integrity="sha256-5Wuqy8aSzReNhqwX5eDQlDZkMT18OJMzvXthwHGKl4o=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" integrity="sha256-Zd1icfZ72UBmsId/mUcagrmN7IN5Qkrvh75ICHIQVTk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="presentation.css"/>
    <title>Spark ML meets Real Estate</title>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <h1>Spark ML Meets Real Estate</h1>
        </section>

        <section>
            <h2>Who am I?</h2>

            <p>
                Matthias Langer (m.langer798@gmail.com)
            </p>

            <div style="width: 60%; margin: auto">
                <a style="line-height: 4em;" href="https://github.com/mlangc">
                    <img alt="mlangc" class="avatar width-full rounded-2"
                         src="https://avatars2.githubusercontent.com/u/7326646?v=3&amp;s=460" width="100"
                         style="float: left">
                    mlangc on
                    <img class="emoji" title=":octocat:" alt=":octocat:"
                         src="https://assets-cdn.github.com/images/modules/logos_page/Octocat.png" width="100"
                         align="absmiddle" style="float: right">
                </a>
            </div>

        </section>
        <section>
            <div style="display: flex; justify-content: space-around; align-items: center;">
                <img style="width: 80%; height: auto; border: none;" src="media/irian.png">
            </div>
        </section>

        </section>
        <section>
            <section>
                <h2>The Problem at Hand</h2>
            </section>
            <section>
                <img style="width: 80%; height: auto; border: none; box-shadow: none; background: none;" src="media/toprop.svg">
            </section>
            <section>
                <h3>Crawling Pipeline</h3>
                <img src="media/crawling-pipeline.png" width="80%" style="border: none; box-shadow: none">
            </section>
            <section>
                <h3>Classification Problem</h3>
                <img src="media/classifications.png" width="80%" style="border: none; box-shadow: none">
            </section>

            <section>
                <h3>The Classes</h3>
                <table>
                    <tbody>
                    <tr>
                        <td>PropertyType</td>
                        <td>3</td>
                        <td>Residential, Commercial, Misc</td>
                    </tr>
                    <tr>
                        <td>PropertySubType</td>
                        <td>15</td>
                        <td>Apartment, AtticFlat, Lot, SingleFamilyHouse, Villa, Premise, Office, Store, Garage, ...</td>
                    </tr>
                    <tr>
                        <td>ListingCategory</td>
                        <td>2</td>
                        <td>Lease, Purchase</td>
                    </tr>
                    </tbody>
                </table>
                <p>
                </p>
            </section>

            <section>
                <h3>Classifier App</h3>

                <ul>
                    <li>Mechanical Turk was not an option</li>
                    <li>Uses reverse proxy and some custom hacks to make HTML look good</li>
                    <li>Non trivial development effort of its own</li>
                    <li>Stored in Postgres</li>
                </ul>
            </section>

            <section>
                <h3>Labeled Examples</h3>
                <ul>
                    <li>
                        Total: ~48000 (~38000 for training, ~10000 for test)
                    </li>
                    <li>
                        42 different labels
                    </li>
                    <li>
                        Majority class: ~19% (Residential, Apartment, Purchase)
                    </li>
                    <li>
                        Spam: ~6%
                    </li>
                    <li>
                        Set is fairly unbalanced: <0.01% (Garage, Purchase, Lease)
                    </li>
                </ul>
            </section>

            <section>
                <h3>Baselines accuracies</h3>
                <ul>
                    <li>Random classifier:  2.5%</li>
                    <li>Majority classifier: 19%</li>
                    <li>Human: 92.5% - 96%</li>
                </ul>
            </section>

            <section>
                <h3>Probably should have used tags</h3>
            </section>
        </section>

        <section>
            <section>
                <h2>Implementation Details</h2>
            </section>

            <section>
                <h3>To Spark or not to Spark</h3>
            </section>

            <section>
                <h3>Spark Mlib vs. ML</h3>
                <p>RDDs vs DataFrames and DataSet</p>
            </section>

            <section>
                <h3>Bird Eyes View on Spark ML</h3>
                <img src="media/estimators-and-pipelines.png" style="border: none; box-shadow: none;">
            </section>

            <section id="how-this-looks-in-spark">
                <h2>How this looks in Spark</h2>
                <pre>
                    <code class="scala" data-trim data-source-file="src/main/scala/SimpleMlPipeline.scala" data-snip="snip">
                    </code>
                </pre>
            </section>

            <section>
                <h3>Classical ML classification pipeline</h3>
                <img src="media/classification-flow.png" style="border: none; box-shadow: none">
            </section>


            <section>
                <h3>Based on Bag of N-Grams</h3>
                <pre>
                    <code class="scala" data-trim data-source-file="src/main/scala/bag-of-ngrams.sc" data-snip="snip">
                    </code>
                </pre>

                <p class="monospaced">
                    The cat ate the dog:
                </p>

                <p class="monospaced">
                    'the' -> 2, 'the dog' -> 1, 'ate the' -> 1, 'the cat' -> 1,
                    'dog' -> 1, 'dog ate' -> 1, 'ate' -> 1, 'cat' -> 1
                </p>
            </section>

            <section>
                <h3>Unit Extraction</h3>
                <p class="monospaced">
                    This flat is 45 m² and costs 350.000 €
                </p>

                <p></p>

                <p class="monospaced">
                    this flat is sqm::Interval(25.0,50.0) and costs euros::Interval(250000.0,500000.0)
                </p>
            </section>

            <section id="syn-normalization">
                <h3>Synonym Normalization</h3>

                <p class="monospaced">
                    Dg-Wohnung ==> syn::DgWohnung
                </p>
                <p class="monospaced">
                    Dachgeschosswohnung ==> syn::DgWohnung
                </p>
                <p class="monospaced">
                    Dachgeschossmaisonette ==> syn::DgWohnung
                </p>
                <p class="monospaced">
                    Dachgetagenwohnung ==> syn::DgWohnung
                </p>
            </section>

            <section id="stemming">
                <h3>Stemming and Splitting</h3>

                <div class="left">
                    <p class="monospaced">
                        Küche ==> kuch
                    </p>
                    <p class="monospaced">
                        Küchen ==> kuch
                    </p>
                    <p class="monospaced">
                        Haus ==> haus
                    </p>
                    <p class="monospaced">
                        Häuser ==> haus
                    </p>
                </div>

                <div class="right">
                    <p class="monospaced">
                        Dachgeschosstraum ==> dachgeschosstraum dach geschoß traum
                    </p>
                </div>
            </section>

            <section id="accuracies1">
                <h3>Accuracies Total</h3>

                <table>
                    <thead>
                    <tr>
                        <td>r. t.</td><td>syns</td><td>clean</td><td>ngr.</td><td>acc</td>
                    </tr>
                    </thead>

                    <tbody>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>1</td><td>89.2%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>no</td><td>2</td><td>89.4%</td>
                    </tr>
                    <tr>
                        <td>no</td><td>yes</td><td>yes</td><td>2</td><td>89.8%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>no</td><td>yes</td><td>2</td><td>89.8%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>3</td><td>90.0%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>2</td><td>90.1%</td>
                    </tr>
                    </tbody>
                </table>
            </section>

            <section id="accuracies2">
                <h3>Errors Lease/Purchase</h3>

                <table>
                    <thead>
                    <tr>
                        <td>r. t.</td><td>syns</td><td>clean</td><td>ngr.</td><td>err</td>
                    </tr>
                    </thead>

                    <tbody>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>1</td><td>0.46%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>no</td><td>2</td><td>0.39%</td>
                    </tr>
                    <tr>
                        <td>no</td><td>yes</td><td>yes</td><td>2</td><td>0.49%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>no</td><td>yes</td><td>2</td><td>0.36%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>3</td><td>0.34%</td>
                    </tr>
                    <tr>
                        <td>yes</td><td>yes</td><td>yes</td><td>2</td><td>0.36%</td>
                    </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h3>Train-Validation-Test Split</h3>
                <img src="media/train-validation-test-split.png" width="80%" style="border: none; box-shadow: none">
            </section>

            <section id="feature-tuning">
                <h3>Feature Tuning</h3>
                <pre>
                <code class="scala" data-trim data-source-file="src/main/scala/DemonstrateFeatureTuning.scala" data-snip="snip">
                </code>
                </pre>
            </section>

            <section>
                <h3>Hyper Parameter Tuning</h3>
                <pre>
                <code class="scala" data-trim data-source-file="src/main/scala/DemonstrateHyperParamTuning.scala" data-snip="snip">
                </code>
                </pre>
            </section>

            <section>
                <h3>Hyper Params Are Relevant</h3>

                <table>
                    <thead>
                    <tr>
                        <td></td><td>L/P Err.</td> <td>Total Acc.</td><td>Total Err.</td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>Defaults</td><td>0.075%</td><td>87.0%</td><td>13.0%</td>
                    </tr>
                    <tr>
                        <td>Tuned</td><td>0.036%</td><td>90.1%</td><td>9.9%</td>
                    </tr>
                    </tbody>
                </table>
            </section>

            <section>
                <h3>Choosing between different Algorithms</h3>
                <pre>
                <code class="scala" data-trim data-source-file="src/main/scala/DemonstrateAlgSelection.scala" data-snip="snip">
                </code>
                </pre>
            </section>
        </section>

        <section>
            <section>
                <h2>Summary and Findings</h2>
            </section>

            <section>
                <h3>Be aware of Sparks complexity</h3>
            </section>

            <section>
                <h3>Consider training your model on tags</h3>
            </section>

            <section>
                <h3>Apply domain knowledge</h3>
            </section>

            <section>
                <h3>Don't forget hyperparemter tuning</h3>
            </section>

            <section>
                <h3>And above all: Have fun!</h3>
            </section>
        </section>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/lib/js/head.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/js/reveal.min.js"></script>
<script>
    Reveal.initialize({
        math: {
            config: 'TeX-AMS_HTML-full',
            mathjax: "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js"
        },
        dependencies: [
            {
                src: "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/plugin/highlight/highlight.min.js",
                async: true,
                callback: function() {
                    $('pre code[data-source-file]').each(function (i, block) {
                        var sourceFile = block.getAttribute('data-source-file');
                        $.get('http://localhost:8000/' + sourceFile, function (source) {
                            var snip = block.getAttribute('data-snip');
                            if (!snip) {
                                $(block).html(source);
                            } else {
                                var snipped = '';
                                var lines = source.split('\n');
                                var inSnipped= false;
                                var marker = '---' + snip + '---';
                                var margin = -1;
                                for (var i = 0; i < lines.length; ++i) {
                                    var line = lines[i];
                                    var containsMarker = line.includes(marker);

                                    if (!inSnipped) {
                                        if (containsMarker) {
                                            inSnipped = true;
                                        }
                                    } else {
                                        if (containsMarker) {
                                            inSnipped = false
                                        } else {
                                            if (margin < 0) {
                                                margin = line.search(/\S|$/);
                                            }

                                            snipped += (snipped != '' ? '\n' : '') + line.substr(margin);
                                        }
                                    }

                                }

                                $(block).html(snipped);
                            }
                        });
                    });

                    hljs.initHighlightingOnLoad();
                }
            },
            {
                src: "https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/plugin/math/math.min.js",
                async: true
            }
        ]
    });
</script>
</body>
</html>